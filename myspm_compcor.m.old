function EXP = myspm_compcor (EXP)
% EXP = myspm_compcor (EXP)
%
% This does:
%   computes mean global signal, 
%   and 6 principle components for each WM and CSF mask for aCompCor
%   and saves them in {fname_epi}_Comp.mat
%
% EXP requires:
%  .query_seg
%  .fname_epi
%
% (cc) 2015, sgKIM.   solleo@gmail.com   https://ggooo.wordpress.com

% func = load_untouch_nii(EXP.fname_epi);
% d = size(func.img);
% nv = prod(d(1:3));
% y = zeros([d(4),nv]);
% for t=1:d(4)
%   y(t,:) = reshape(func.img(:,:,:,t),[1,nv]);
% end
% clear func
% [~,res] = mydir(EXP.query_seg);
% for c=1:3
%   MASK{c}=load_untouch_nii(res{c});
% end
% IDX{1} = (MASK{1}.img>0.7) | (MASK{2}.img>0.7) | (MASK{3}.img>0.7);
% IDX{2} = MASK{2}.img>0.99;
% IDX{3} = MASK{3}.img>0.99;
% Comp=[];
% Comp.name={'gm','wm','csf'};
% Comp.y{1} = mean(y(:,IDX{1}(:)),2);
% for c=2:3
%   Comp.y{c} = pca(y(:,IDX{c}(:)),6);
% end
% [path1,name1,~]=fileparts(EXP.fname_epi);
% save([path1,'/',name1,'_Comp.mat'],'Comp');

end